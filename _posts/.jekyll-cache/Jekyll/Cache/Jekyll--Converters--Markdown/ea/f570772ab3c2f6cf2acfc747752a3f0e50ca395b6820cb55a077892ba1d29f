I"¨%<p><strong>with rollup ì‚¬ìš© ì˜ˆì‹œ</strong></p>

<ul>
  <li>ì¿¼ë¦¬ ë§ˆì§€ë§‰ì— rollupì„ ë¶™ì´ë©´ ì´í•©ê³„ê¹Œì§€ ë‚˜ì˜¨ë‹¤</li>
  <li>ëŒ€ì‹  NULLì´ ë‚˜ì˜¤ê³  ORDER BYì™€ í•¨ê»˜ ì“¸ ìˆ˜ ì—†ì–´ì„œ ì„œë¸Œ ì¿¼ë¦¬ì™€ IFNULL í™œìš©</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">ifnull</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">team_id</span><span class="p">,</span> <span class="s1">'TOTAL'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">team_id</span><span class="p">,</span> <span class="n">x</span><span class="p">.</span><span class="n">purchase_cnt</span> 
<span class="k">from</span> 
<span class="p">(</span><span class="k">select</span> <span class="n">a</span><span class="p">.</span><span class="n">team_id</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="err">êµ¬ë§¤</span><span class="n">id</span><span class="p">)</span> <span class="k">as</span> <span class="n">purchase_cnt</span> 
 <span class="k">from</span> <span class="err">êµ¬ë§¤í…Œì´ë¸”</span> <span class="n">a</span><span class="p">,</span> <span class="err">í”„ë¡œë•íŠ¸í…Œì´ë¸”</span> <span class="n">b</span> 
 <span class="k">where</span> <span class="n">a</span><span class="p">.</span><span class="err">í”„ë¡œë•íŠ¸ë„˜ë²„</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="err">í”„ë¡œë•íŠ¸ë„˜ë²„</span>  
 <span class="k">and</span> <span class="err">í”„ë¡œë•íŠ¸í…Œì´ë¸”</span><span class="n">_</span><span class="err">ì¡°ê±´</span>
 <span class="k">group</span> <span class="k">by</span> <span class="n">a</span><span class="p">.</span><span class="n">team_id</span> 
 <span class="k">with</span> <span class="k">rollup</span><span class="p">)</span> <span class="n">x</span> 
 <span class="k">order</span> <span class="k">by</span> <span class="n">x</span><span class="p">.</span><span class="n">purchase_cnt</span> <span class="k">desc</span><span class="p">;</span>
</code></pre></div></div>

<p><img src="../../../../img/2021-12-05-SQL3/image.png" alt="image" /></p>

<p>.</p>

<p>.</p>

<hr />

<p><strong>ì´íƒˆ ìœ ì € êµ¬í•˜ëŠ” ì¿¼ë¦¬</strong></p>

<ul>
  <li>datediff í•¨ìˆ˜ ì‚¬ìš©</li>
  <li>https://www.duck.pe.kr/213</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">a</span><span class="p">.</span><span class="n">team_id</span><span class="p">,</span> <span class="n">date_format</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">crt_date</span><span class="p">,</span> <span class="s1">'%Y-%m-%d'</span><span class="p">)</span> <span class="k">as</span> <span class="n">crt_date</span> <span class="k">from</span>
<span class="p">(</span><span class="k">select</span> <span class="n">team_id</span><span class="p">,</span> <span class="n">datediff</span><span class="p">(</span><span class="n">date_format</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span> <span class="s1">'%Y-%m-%d'</span><span class="p">),</span> <span class="n">last_login_date</span><span class="p">)</span> <span class="k">as</span> <span class="n">leaving</span><span class="p">,</span> <span class="n">crt_date</span> 
 <span class="k">from</span> <span class="err">íŒ€í…Œì´ë¸”</span> <span class="k">where</span> <span class="n">status</span> <span class="o">=</span> <span class="s1">'OK'</span> <span class="k">and</span> <span class="n">crt_date</span> <span class="o">&gt;</span> <span class="s1">'2020-05-05'</span><span class="p">)</span> <span class="n">a</span>
<span class="k">where</span> <span class="n">a</span><span class="p">.</span><span class="n">leaving</span> <span class="o">&gt;=</span> <span class="mi">7</span><span class="p">;</span>
</code></pre></div></div>

<p>.</p>

<p>.</p>

<hr />

<p><strong>mid í•¨ìˆ˜</strong></p>

<ul>
  <li>cpm arena í‰ê·  ìŠ¹ìˆ˜ êµ¬í•  ë•Œ ì‚¬ìš©</li>
  <li>log_typeì´ â€˜â€˜ìˆ˜ë ¹â€™â€˜ì¼ ë•Œ ë‹¤ìŒê³¼ ê°™ì´ ìŠ¹ìˆ˜ê°€ ê¸°ë¡ë¨
    <ul>
      <li>ref_valueì— CARENA_WIN_2 -&gt; 2ìŠ¹, CARENA_WIN_10 -&gt; 10ìŠ¹, CARENA_WIN_0 -&gt; 0ìŠ¹</li>
      <li>mid(ref_value, 12, 2) -&gt; 12ë²ˆì§¸ë¶€í„° ì˜ë¼ì„œ 2ê°œ</li>
    </ul>
  </li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">mid</span><span class="p">(</span><span class="n">ref_value</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="n">win</span> <span class="k">from</span> <span class="err">ì•„ë ˆë‚˜</span><span class="n">_</span><span class="err">ë¡œê·¸</span><span class="n">_</span><span class="err">í…Œì´ë¸”</span> <span class="k">where</span> <span class="n">log_type</span> <span class="o">=</span> <span class="s1">'ìˆ˜ë ¹'</span><span class="p">;</span>
</code></pre></div></div>

<p>.</p>

<p>.</p>

<hr />

<p><strong>ANY, SOME, ALL ì˜ˆì‹œ</strong></p>

<ul>
  <li>https://ggmouse.tistory.com/12</li>
  <li>ANY = SOME = ì„œë¸Œ ì¿¼ë¦¬ì˜ MIN ê°’ í•„í„°ë§ì— ì‚¬ìš©</li>
  <li>ALL = ì„œë¸Œ ì¿¼ë¦¬ì˜ MAX ê°’ í•„í„°ë§ì— ì‚¬ìš©</li>
</ul>

<p>.</p>

<p>.</p>

<hr />

<p><strong>CONCAT ì˜ˆì‹œ</strong></p>

<ul>
  <li>ë¬¸ìì—´ í•©ì„±ì— ì‚¬ìš©</li>
  <li>ì„ ìˆ˜_í…Œì´ë¸”ì—ëŠ” skill_codes ë¼ëŠ” ì»¬ëŸ¼ì— ì—¬ëŸ¬ ì¢…ë¥˜ì˜ ìŠ¤í‚¬ì´ ë“¤ì–´ê°€ ìˆìŒ
    <ul>
      <li>ex. [â€œìŠ¤í‚¬1â€, â€œìŠ¤í‚¬2â€]</li>
    </ul>
  </li>
  <li>ìŠ¤í‚¬_í…Œì´ë¸”ì—ëŠ” ë”°ì˜´í‘œì™€ ëŒ€ê´„í˜¸ ì—†ì´ ìŠ¤í‚¬1 ë¡œ ì €ì¥</li>
  <li>íŠ¹ì • ìŠ¤í‚¬ íƒ€ì…ì„ ê°€ì§„ ì„ ìˆ˜idë¥¼ ê²€ìƒ‰í•  ë•Œ ì‚¬ìš©</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="err">ì„ ìˆ˜</span><span class="n">id</span><span class="p">,</span> <span class="n">skill_codes</span> <span class="k">from</span> <span class="err">ì„ ìˆ˜</span><span class="n">_</span><span class="err">í…Œì´ë¸”</span> <span class="n">p</span><span class="p">,</span> <span class="err">ìŠ¤í‚¬</span><span class="n">_</span><span class="err">í…Œì´ë¸”</span> <span class="n">s</span> 
<span class="k">where</span> <span class="n">s</span><span class="p">.</span><span class="n">skill_type</span> <span class="o">=</span> <span class="s1">'íƒ€ì…1'</span> <span class="k">and</span> <span class="n">p</span><span class="p">.</span><span class="n">skill_codes</span> <span class="o">=</span> <span class="n">concat</span><span class="p">(</span><span class="s1">'["'</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">skill_code</span><span class="p">,</span> <span class="s1">'"]'</span><span class="p">);</span>


<span class="k">select</span> <span class="err">ì„ ìˆ˜</span><span class="n">id</span><span class="p">,</span> <span class="n">skill_codes</span> <span class="k">from</span> <span class="err">ì„ ìˆ˜</span><span class="n">_</span><span class="err">í…Œì´ë¸”</span> <span class="n">p</span><span class="p">,</span> <span class="err">ìŠ¤í‚¬</span><span class="n">_</span><span class="err">í…Œì´ë¸”</span> <span class="n">s</span> 
<span class="k">where</span> <span class="n">s</span><span class="p">.</span><span class="n">skill_type</span> <span class="o">=</span> <span class="s1">'íƒ€ì…1'</span> <span class="k">and</span> <span class="n">p</span><span class="p">.</span><span class="n">skill_codes</span> <span class="k">like</span> <span class="n">concat</span><span class="p">(</span><span class="s1">'%'</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">skill_code</span><span class="p">,</span> <span class="s1">'%'</span><span class="p">);</span>
</code></pre></div></div>

<p>.</p>

<p>.</p>

<hr />

<p><strong>json ì²˜ë¦¬</strong></p>

<ul>
  <li>simple_statì´ë¼ëŠ” ì»¬ëŸ¼ì— batStatê³¼ pitStatìœ¼ë¡œ ë‚˜ëˆ ì ¸ ìˆê³ </li>
  <li>ê°ê°ì— ë‹¤ì–‘í•œ ê°’ë“¤ì´ ë“¤ì–´ê°€ ìˆì—ˆì„ ë•Œ json_extract ì‚¬ìš©</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">player_id</span><span class="p">,</span> 
<span class="n">json_extract</span><span class="p">(</span><span class="n">simple_stat</span><span class="p">,</span> <span class="s1">'$.batStat.contact'</span><span class="p">)</span> <span class="k">as</span> <span class="n">contact</span><span class="p">,</span> 
<span class="n">json_extract</span><span class="p">(</span><span class="n">simple_stat</span><span class="p">,</span> <span class="s1">'$.batStat.gapPow'</span><span class="p">)</span> <span class="k">as</span> <span class="n">gapPow</span><span class="p">,</span>
<span class="n">json_extract</span><span class="p">(</span><span class="n">simple_stat</span><span class="p">,</span> <span class="s1">'$.pitStat.control'</span><span class="p">)</span> <span class="k">as</span> <span class="n">control</span><span class="p">,</span> 
<span class="n">json_extract</span><span class="p">(</span><span class="n">simple_stat</span><span class="p">,</span> <span class="s1">'$.pitStat.stuff'</span><span class="p">)</span> <span class="k">as</span> <span class="n">stuff</span>
<span class="k">from</span> <span class="n">player</span><span class="p">;</span>
</code></pre></div></div>

<p>.</p>

:ET